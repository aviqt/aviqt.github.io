(window.webpackJsonp=window.webpackJsonp||[]).push([[22],{448:function(e,t,n){var content=n(552);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[e.i,content,""]]),content.locals&&(e.exports=content.locals);(0,n(22).default)("20b9a69f",content,!0,{sourceMap:!1})},551:function(e,t,n){"use strict";n(448)},552:function(e,t,n){var o=n(21)(!1);o.push([e.i,".download-btn[data-v-5de25298]{cursor:pointer;color:#4177ff;text-decoration:underline;display:block;position:absolute;top:50px;left:20px;font-size:16px;font-weight:400}.download-btn[data-v-5de25298]:hover{color:orange}.playWnd[data-v-5de25298]{background:#fff;width:100%;height:100%}body[data-v-5de25298]{background-size:cover}.top-userInfo[data-v-5de25298]{background:#000;color:#fff}.top-userInfo>strong[data-v-5de25298]{font-size:18px;float:left;margin-left:20px;display:inline-block}.top-userInfo .button[data-v-5de25298]:hover{background:#666}.container[data-v-5de25298]{top:70px;left:20px}.container[data-v-5de25298],.container .box[data-v-5de25298]{position:absolute;right:0;bottom:0}.container .box[data-v-5de25298]{top:0;left:0;margin-right:20px;margin-bottom:20px}.container .box[data-v-5de25298]:first-child{right:30%}.container .box[data-v-5de25298]:nth-child(2){left:70%}.box-head[data-v-5de25298]{border-left:5px solid #4177ff;line-height:24px;padding-left:8px;font-size:20px;font-weight:700}.box-head .camera-list[data-v-5de25298]{position:absolute;left:100px;top:0}.box-head a[data-v-5de25298]{color:#4177ff;margin-left:50px;font-size:16px;text-decoration:none;font-weight:400}.box-head a[data-v-5de25298]:hover{text-decoration:underline}.camera-list span[data-v-5de25298]{font-size:16px;cursor:pointer;padding:0 10px}.camera-list .selected[data-v-5de25298]{color:#4177ff;font-weight:700}.box-body[data-v-5de25298]{position:absolute;left:0;bottom:0;right:0;top:35px;background:#fff}.point-top[data-v-5de25298]{position:absolute;width:160px;right:30px;top:-30px;line-height:30px;text-align:right;display:table}.point-top span[data-v-5de25298]{display:table-cell;width:80px;text-align:center}.focus[data-v-5de25298]{color:#4177ff}",""]),e.exports=o},579:function(e,t,n){"use strict";n.r(t);var o=n(396),r=(n(56),n(40),n(382)),c=n.n(r),d=n(228),l=n(79),m=n(383),f=n(442),h=n(455),v=n(456),x=n(457),I=n(12),w=n.n(I),_={mixins:[l.a,f.a,m.a],components:{ImgView:h.a,ImgListView:x.a,AuthImgView:v.a},data:function(){return{tabViewIndex:0,scoreRuleLines:[],picList:[],picListNew:[],examIndex:0,examData:[],status:0,imgViewIndex:0,imgInfo:[],paperInfo:[],focusPointIndex:1,downloadBtnView:!1}},mounted:function(){var e=JSON.parse(window.localStorage.getItem("adminUserData"));this.$store.commit("admin/SET_USERDATA",e),sessionStorage.getItem("mPIndex")?this.examIndex=sessionStorage.getItem("mPIndex"):sessionStorage.setItem("mPIndex",this.examIndex),this.getExamData()},methods:{setTabViewIndex:function(e){this.tabViewIndex=e,0===e?(this.setWndCover&&this.setWndCover(!1),this.viewDoubleVideo()):this.setWndCover&&this.setWndCover(!0)},downloadVideoWebPlugin:function(){var e=this;this.$store.commit("admin/CHANGE_LOADING"),w()({url:"/api/teacher/download/haikangTemplate",method:"get",headers:{"Content-Type":"application/octet-stream"},responseType:"blob"}).then((function(t){d.a.downloadFile(t,"VideoWebPlugin.exe"),e.$store.commit("admin/CHANGE_LOADING")})).catch((function(t){e.$store.commit("admin/CHANGE_LOADING")}))},SRLkeydown:function(e,t){-1!==[37,38,39,40,13].indexOf(e.keyCode)&&(38===e.keyCode&&(this.focusPointIndex=this.focusPointIndex>1?this.focusPointIndex-1:1),40===e.keyCode&&(this.focusPointIndex=this.focusPointIndex<19?this.focusPointIndex+1:19),c()(".rule-point").eq(this.focusPointIndex-1).focus(),"0"!==this.examData.isMarked?(13===e.keyCode&&(t.markInfoLine.answerRight="0"===t.markInfoLine.answerRight?"1":"0"),37===e.keyCode&&(t.markInfoLine.answerRight="1"),39===e.keyCode&&(t.markInfoLine.answerRight="0"),this.updateScoreRuleLines(),e.preventDefault()):e.preventDefault())},updateScoreRuleLines:function(){var e=Object(o.a)(this.scoreRuleLines);this.scoreRuleLines=e},checkMarkPoint:function(){var e=this;this.setWndCover&&this.setWndCover(!0),this.imgInfo={show:!0,iSmall:!1,normal:!0,picList:[{url:"/api".concat(this.examData.markPoint)}],currentIndex:0,handlCancleEvent:function(){e.setWndCover&&e.setWndCover(!1)}}},handleClickImg:function(e,i,b){var t=this;this.tabViewIndex=1,this.setWndCover&&this.setWndCover(!0),this.imgInfo={show:!0,iSmall:b||!1,picList:this.picListNew,currentIndex:i,handlCancleEvent:function(){}},setTimeout((function(){t.$refs.authImgView&&t.$refs.authImgView.getSrcData&&t.$refs.authImgView.getSrcData()}),50)},checkVideo:function(e,t){var n=-1===t.indexOf("全景")?2:1,o=this.picListNew[e],r=new Date(new Date(o.time).getTime()-3e4),c=new Date(new Date(o.time).getTime()+3e4);this.playerOp.layout="1x1",this.tabViewIndex=3;var d=this.playerOp.layout,l=this;this.oWebControl&&this.oWebControl.JS_RequestInterface({funcName:"setLayout",argument:JSON.stringify({layout:d})}).then((function(e){l.startPlayback(null,r,n,c)}))},submitMark:function(){var e=this,t=[];this.scoreRuleLines.map((function(line){line.rules.map((function(e){t.push({ruleLineId:e.id,answerRight:e.markInfoLine.answerRight?e.markInfoLine.answerRight:""})}))}));var n=new FormData;n.append("examHeaderId",this.examData.examHeaderId),n.append("markLine",t),this.$store.dispatch("teacher/SUBMIT_MARK",{data:{examHeaderId:this.examData.examHeaderId,markLine:t},cb:function(t){t.succ&&(e.$message.success("评卷成功"),e.examData.isMarked="0",e.getNextExam())}})},getNextExam:function(){sessionStorage.setItem("mPIndex",++this.examIndex),this.getExamData()},setPicList:function(data){var e=this;this.picList={0:data.pic2?data.pic2:[],1:data.pic1?data.pic1:[]},this.picListNew=[];if(0!=this.picList[0].length){var t=this.paperList.filter((function(t){return t.id===e.paperInfo.id}))[0].mepImgType;for(var n in this.picListNew=[],t){var o=this.picList[t[n]][n];o&&this.picListNew.push({url:o.picUrl?o.picUrl:"http://experimentexam.oss-cn-beijing.aliyuncs.com/student/01.jpg",time:o.picUrl})}console.log(this.picListNew)}},startCountDown:function(){0!==this.countDown.timeLimit&&(this.countDown.timeLimit-=1,this.countDown.timer=setTimeout(this.startCountDown,1e3))},viewDoubleVideo:function(){if("1x2"!==this.playerOp.layout){this.playerOp.layout="1x2";var e=this.playerOp.layout,t=this;this.oWebControl&&this.oWebControl.JS_RequestInterface({funcName:"setLayout",argument:JSON.stringify({layout:e})}).then((function(e){t.startPlayback(null,null,1,null,1),t.startPlayback(null,null,2,null,2)}))}},getExamData:function(){var e=this,data=[],t="";sessionStorage.getItem("mPScheduleId")?(data={scheduleId:sessionStorage.getItem("mPScheduleId"),index:this.examIndex},t="teacher/GET_NEXT_EXAM",this.status=0):(data={examHeaderId:sessionStorage.getItem("mpExamHeaderId")},t="teacher/GET_STUDENT_EXAM",this.status=1),this.$store.dispatch(t,{data:data,cb:function(t){if(t.succ){for(var n in e.examData=t.data?t.data:[],e.paperInfo.id=e.examData.paperId?e.examData.paperId:1,e.paperInfo.answer=[],e.examData.examLines&&e.examData.examLines.map((function(t){e.paperInfo.answer.push(t.remark?t.remark:"")})),e.videoList=[],t.data.video)e.videoList.push(t.data.video[n]);e.videoList.reverse(),e.scoreRuleLines=t.data.scoreRuleLines?t.data.scoreRuleLines:[],e.scoreRuleLines=e.scoreRuleLines.map((function(e){return e.rules=e.rules.map((function(e){return e.markInfoLine||(e.markInfoLine={answerRight:"0"}),e})),e})),e.setPicList(t.data),e.selectedVideoIndex=3,e.setWndCover&&e.setWndCover(!0);setTimeout((function(){0===e.videoList.length?e.viewPaper():e.oWebControl?e.setTabViewIndex(0):e.initPlugin()}),500);"0"!==e.examData.isMarked&&(e.countDown.timeLimit=10,e.startCountDown())}else sessionStorage.setItem("mPIndex",--e.examIndex)}})}},computed:{ruleLineWidth:function(){return.4*(this.DcSize.width-20)-40-20+"px"},markCompleted:function(){var e=!0;return this.scoreRuleLines.map((function(line){line.rules.map((function(t){e=e&&t.markInfoLine.answerRight}))})),e},totalScore:function(){var e=0;return this.scoreRuleLines.map((function(line){line.rules.map((function(t){e+=parseFloat(t.reqNum)}))})),e},score:function(){var e=0;return this.scoreRuleLines.map((function(line){line.rules.map((function(t){e+="0"===t.markInfoLine.answerRight?parseFloat(t.reqNum):0}))})),e}},head:function(){return{title:"实验考试评卷系统",script:[{src:"../../../jsWebControl-1.0.0.min.js"},{src:"../../../jsencrypt.min.js"}]}}},k=(n(551),n(13)),component=Object(k.a)(_,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{directives:[{name:"loading",rawName:"v-loading",value:e.$store.state.admin.loading,expression:"$store.state.admin.loading"}],staticStyle:{position:"relative"},style:{height:e.DcSize.height+"px"}},[n("div",{staticClass:"top-userInfo"},[n("strong",[e._v("中学科学实验教考管理系统")]),e._v("\n    您好，"+e._s(e.$store.state.admin.adminUserData.userName)+"！\n    "),n("div",{staticClass:"button",on:{click:function(t){return e.confrimLogout()}}},[n("i",{staticClass:"iconfont icon-power"}),e._v(" 退出")])]),e._v(" "),n("div",{staticClass:"container"},[n("div",{staticClass:"box"},[n("div",{staticClass:"box-head"},[e._v("\n        网上阅卷\n        "),n("div",{staticClass:"camera-list"},[n("span",{class:{selected:0===e.tabViewIndex},on:{click:function(t){return e.setTabViewIndex(0)}}},[n("i",{staticClass:"el-icon-video-camera"}),e._v("\n            完整录像\n          ")]),e._v(" "),n("span",{class:[{selected:1===e.tabViewIndex}],on:{click:function(t){return e.setTabViewIndex(1)}}},[n("i",{staticClass:"el-icon-picture-outline"}),e._v("\n            考查得分图片\n          ")]),e._v(" "),n("span",{class:{selected:2===e.tabViewIndex},on:{click:function(t){return e.setTabViewIndex(2)}}},[n("i",{staticClass:"el-icon-document"}),e._v("\n            查看试卷\n          ")])])]),e._v(" "),n("div",{staticClass:"box-body",staticStyle:{overflow:"auto"}},[e.downloadBtnView&&0!=e.videoList.length&&0===e.tabViewIndex?n("span",{staticClass:"download-btn",on:{click:e.downloadVideoWebPlugin}},[e._v("点击下载视频插件")]):e._e(),e._v(" "),n("div",{staticClass:"playWnd video-player-box",attrs:{id:"playWnd"}})]),e._v(" "),2===e.tabViewIndex?n("div",{staticClass:"box-body",staticStyle:{overflow:"auto"}},[n(e.paperList.filter((function(t){return t.id===e.paperInfo.id}))[0].com,{tag:"component",attrs:{paperInfo:e.paperInfo}})],1):e._e(),e._v(" "),1===e.tabViewIndex?n("div",{staticClass:"box-body",staticStyle:{overflow:"auto"}},[n("img-list-view",{attrs:{picList:e.picListNew,handleClickImg:e.handleClickImg}}),e._v(" "),e.imgInfo.show&&e.imgInfo.iSmall?n("auth-img-view",{ref:"authImgView",attrs:{imgInfo:e.imgInfo}}):e._e()],1):e._e()]),e._v(" "),n("div",{staticClass:"box"},[n("div",{staticClass:"box-head"},[e._v("\n        评分标准\n        "),n("a",{attrs:{href:"javascript:void()"},on:{click:function(t){return e.checkMarkPoint()}}},[e._v("评分要点>")])]),e._v(" "),n("div",{staticClass:"box-body"},[e._m(0),e._v(" "),n("div",{staticClass:"score-rule-lines"},e._l(e.scoreRuleLines,(function(line,i){return n("div",{key:i,staticClass:"rule-line"},[n("strong",[e._v(e._s(i+1)+". "+e._s(line.title))]),e._v(" "),e._l(line.rules,(function(t,o){return n("div",{key:t.checkNum,staticClass:"rule-point ",attrs:{tabindex:"0"},on:{keydown:function(n){return e.SRLkeydown(n,t)},click:function(n){e.focusPointIndex=parseInt(t.checkNum)}}},[n("div",[e._v("\n                ("+e._s(t.checkNum)+") "+e._s(t.checkRemark)+"\n                "),!t.picNum||t.videoType&&-1!==t.videoType.indexOf("ONLY")?e._e():n("i",{staticClass:"el-icon-picture-outline icon",attrs:{title:"查看图片"},on:{click:function(n){return e.handleClickImg(n,t.picNum-1,!0)}}}),e._v(" "),t.videoType?n("i",{staticClass:"el-icon-video-camera icon",attrs:{title:"查看视频"},on:{click:function(n){return e.checkVideo(t.picNum-1,t.videoType)}}}):e._e(),e._v(" "),(t.examLine,e._e())]),e._v(" "),n("div",{staticStyle:{width:"80px","text-align":"center"}},[n("el-switch",{attrs:{"inactive-color":"#ff4949","active-value":"0","inactive-value":"1",width:25,disabled:"0"===e.examData.isMarked},on:{change:e.updateScoreRuleLines},model:{value:t.markInfoLine.answerRight,callback:function(n){e.$set(t.markInfoLine,"answerRight",n)},expression:"point.markInfoLine.answerRight"}})],1)])}))],2)})),0),e._v(" "),e.scoreRuleLines.length>0?n("div",{staticClass:"score-total"},[n("span",[e._v("总分:"+e._s(e.totalScore)+"分")]),e._v(" "),n("span",[e._v("得分:"),n("strong",[e._v(e._s(e.score)+"分")])]),e._v(" "),n("div",{staticClass:"operation"},["1"===e.examData.isMarked?n("el-button",{attrs:{type:e.markCompleted?"primary":"info",disabled:!e.markCompleted||0!=e.countDown.timeLimit},on:{click:e.submitMark}},[e._v("\n              "+e._s(e.markCompleted?0!=e.countDown.timeLimit?e.countDown.timeLimit:"完成评卷":"未完成评卷")+"\n            ")]):e._e(),e._v(" "),"0"===e.examData.isMarked?n("el-button",{attrs:{type:"primary",disabled:""}},[e._v("\n              已完成评卷\n            ")]):e._e(),e._v(" "),0===e.status?n("el-button",{on:{click:e.getNextExam}},[e._v("跳过>>")]):e._e()],1)]):e._e()])])]),e._v(" "),n("el-confrim",{attrs:{confrimInfo:e.confrimInfo}}),e._v(" "),e.imgInfo.show&&!e.imgInfo.iSmall?n("auth-img-view",{attrs:{imgInfo:e.imgInfo}}):e._e()],1)}),[function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"point-top"},[n("span"),e._v(" "),n("span",[e._v("得分")])])}],!1,null,"5de25298",null);t.default=component.exports}}]);